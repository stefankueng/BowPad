<?xml version="1.0" encoding="windows-1252"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <!-- This gets automatically generated by the makefile running SubWCRev.exe on VersionNumberInclude.in.wxi -->
  <?include VersionNumberInclude.wxi ?>
  <Product
    UpgradeCode="25629509-0CA5-493B-AA97-8A2B5C80EF10"
    Name="BowPad"
    Id="*"
    Language="1033"
    Codepage="1252"
    Version="$(var.MajorVersion).$(var.MinorVersion).$(var.BuildVersion)"
    Manufacturer="Stefans Tools">

    <Package Id="*" Keywords="Installer"
          Description="BowPad Text Editor (64-bit)"
          Comments="http://tools.tortoisesvn.net" Manufacturer="Stefans Tools"
          InstallerVersion="200" Languages="1033" Compressed="yes" SummaryCodepage="1252" Platform="x64" />

    <Upgrade Id="25629509-0CA5-493B-AA97-8A2B5C80EF10" >
      <!-- flag is set if the install will trigger an upgrade of an existing install -->
      <UpgradeVersion Property="PREVIOUSVERSIONSINSTALLED" Maximum="$(var.MajorVersion).$(var.MinorVersion).$(var.BuildVersion)" IncludeMaximum="no" />
    </Upgrade>

    <Media Id="1" Cabinet="BowPad.cab" EmbedCab="yes" CompressionLevel="high" />
    <Icon Id="BowPadIcon" SourceFile="..\BowPad.ico" />
    <Property Id="ARPPRODUCTICON">BowPadIcon</Property>
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
    <Property Id="RIBBONFRAMEWORK">
      <RegistrySearch Id="UIRibbon" Root="HKCR" Key="CLSID\{926749fa-2615-4987-8845-c33e65f2b957}\InProcServer32" Type="raw" />
    </Property>
    <Condition Message="This application requires the Windows Ribbon Framework to be installed, i.e. Vista with the Platform update">
      Installed OR RIBBONFRAMEWORK
    </Condition>
    <Condition Message="This application requires an 64-bit OS">VersionNT64</Condition>

    <Property Id="INSTALLDIR">
      <RegistrySearch Id="PreviousInstallLocationRegistrySearch" Root="HKLM" Key="Software\BowPad" Name="installDir" Type="raw" Win64="yes" />
    </Property>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder" Name="PFiles">
        <Directory Id="INSTALLDIR" Name="BowPad">

          <Component Id="BowPad.exe" Guid="666BFAE6-68D2-4F4E-A579-32CDDDA0BA74" Win64="yes">
            <File Id="BowPad.EXE" Name="BowPad.exe" DiskId="1" Source="../../bin/release64/bin/BowPad.exe" Vital="yes" />
          </Component>
          <Component Id="ShellExt" Guid="8DE7F16A-1AD2-484C-8BD5-B63749680BFC" Win64="yes">
            <File Id="BowPadShellExtension.dll" KeyPath="yes" Source="../../bin/release64/bin/BowPadShellExtension.dll">
              <Class Id="{E32BBD98-E7AC-4744-858A-833555B7B582}" Context="InprocServer32" Description="BowPadShellExt.FileContextMenuExt Class" ThreadingModel="apartment" />
            </File>
            <RegistryValue Root="HKCR" Key="*\shellex\ContextMenuHandlers\{E32BBD98-E7AC-4744-858A-833555B7B582}" Value="BowPadShellExt.FileContextMenuExt" Type="string" Action="write" />
          </Component>

        </Directory>
        <Directory Id="ProgramMenuFolder" Name="Programs">
          <Directory Id="ProgramMenuDir" Name="BowPad" />
        </Directory>
      </Directory>

    </Directory>
    <DirectoryRef Id="ProgramMenuDir">
      <Component Id="StartMenuShortCut" Guid="64827EDD-A357-488F-8687-AC7740FF698A" Win64="yes">
        <Shortcut Id="startMenuBowPad" Directory="ProgramMenuDir" Name="BowPad" Target="[INSTALLDIR]BowPad.exe" Description="A Text Editor with a ribbon UI" />
        <RemoveFolder Id="ProgramMenuDir" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\BowPad" Name="installed" Type="integer" Value="1" KeyPath="yes" />
        <IniFile Id="WebsiteUrl" Action="addLine" Name="Website.url" Directory="INSTALLDIR" Section="InternetShortcut" Key="URL" Value="http://tools.tortoisesvn.net" />
        <Shortcut Id="WebsiteUrlShortCut" Directory="ProgramMenuDir" Name="Website" Target="[INSTALLDIR]Website.url" Description="Visit BowPad's Website" />
      </Component>
    </DirectoryRef>

    <Feature Id="Complete" Title="BowPad (64-bit)" Description="The complete package."
          Display="expand" Level="1" ConfigurableDirectory="INSTALLDIR">
      <Feature Id="MainEXE" Title="Program" Description="The main executable." Level="1">
        <ComponentRef Id="BowPad.exe" />
        <ComponentRef Id="ShellExt" />
        <ComponentRef Id="StartMenuShortCut" />
      </Feature>
    </Feature>

    <UI>
      <UIRef Id="WixUI_InstallDir" />
      <!-- skip licence dialog -->
      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="InstallDirDlg" Order="2">1</Publish>
      <Publish Dialog="InstallDirDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg" Order="2">1</Publish>

      <Publish Dialog="ExitDialog"
                  Control="Finish"
                  Event="DoAction"
                  Value="LaunchApplication">WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed</Publish>
    </UI>
    <WixVariable Id="WixUIBannerBmp" Value="Banner.jpg" />
    <WixVariable Id="WixUIDialogBmp" Value="Dialog.jpg" />
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="Launch BowPad" />
    <Property Id="WixShellExecTarget" Value="[#BowPad.EXE]" />
    <CustomAction Id="LaunchApplication" BinaryKey="WixCA" DllEntry="WixShellExec" Impersonate="yes" />

    <InstallExecuteSequence>
      <AppSearch Sequence="1"></AppSearch>
      <LaunchConditions After="AppSearch" />
      <RemoveExistingProducts After="InstallValidate"><![CDATA[PREVIOUSVERSIONSINSTALLED]]></RemoveExistingProducts>
    </InstallExecuteSequence>

  </Product>
</Wix>
